# 3주차 개인과제

## <개인 과제>

### Qemu & KVM

**QEMU**:

- 유저 공간에서 돌아가는 **프로세스**
- 가상머신의 **CPU, 메모리, 디스크, NIC, VGA** 등 하드웨어를 소프트웨어로 만들어줌
- VM 프로세스의 라이프사이클 관리 (시작, 중지, 스냅샷 등)

**KVM**:

- 리눅스 커널 모듈 (`kvm`, `kvm_intel`, `kvm_amd`)
- 커널 안에서 동작
- CPU가 지원하는 가상화 기능을 커널이 직접 사용하게 해줌

### ifconfig랑 ip addr의 차이점

일단 윈도우에선 `ifconfig`를 `ipconfig`라고 한다.

- 리눅스 Network Manager: ip주소 뿐 아니라 대부분의 네트워크 설정들을 모니터링하고 추가 및 수정, 관리하는 데몬
- ifconfig 명령어는 이 Network Manager에서 설정한 정보가 출력되지 않는다.

![image.png](image1/image.png)

### tailscale

- Proxmox APT 레포 오류 해결 + Tailscale 연결 디버깅
    
    **1. Proxmox 쉘 접속**
    
    **2. 유료 레포 제거해서 apt 에러 제거**
    
    ```bash
    cd /etc/apt/sources.list.d
    
    mv pve-enterprise.sources pve-enterprise.sources.bak
    mv ceph.sources ceph.sources.bak
    
    ls
    ```
    
    **3. 무료 레포 + debian + tailscale만 남긴 상태에서 apt 갱신**
    
    ```bash
    apt-get update
    ```
    
    **4. Tailscale 설치**
    
    ```bash
    apt install tailscale
    ```
    
    **5. Tailscale 로그인**
    
    ```bash
    tailscale up
    ```
    
    → 브라우저 자동 열림 → 계정 로그인
    
    **6. 노트북에도 Tailscale 설치 후 같은 계정 로그인**
    
    **7. 노트북에서 Proxmox 접속 확인**
    
    ```
    https://100.70.xx.xx:8006
    ```
    
    → Proxmox GUI 정상 접속 완료
    
- 기본 구조 : [내 PC]  →  [공유기(NAT)]  →  [인터넷]  →  [서버]
    - Private IP들을 **하나의 Public IP**로 바꿔서 인터넷으로 내보내는 번역 장치
    - NAT은 인바운드는 안된다
    - 그래서 외부에서 접속하는 홈서버를 만들려면 포트포워딩을 해야함
- WireGuard 기반 암호화 터널
- NAT Traversal (NAT 패싱 기술)

![image.png](image1/image%201.png)

- apt로 다운받을 때, 유료 레포는 사용 못 해서 무료 레포로 바꿔주고 다운로드를 진행했다
    
    ![image.png](image1/image%202.png)
    
- [https://100.70.58.59:8006](https://100.70.58.59:8006/)

### 내 집 네트워크 물리적 구조 & 논리적 구조

- proxmox, 내 노트북, 공유기 관리자 페이지
    
    ![image.png](image1/image%203.png)
    
    ![image.png](image1/image%204.png)
    
    ![image.png](image1/image%205.png)
    
    - 공유기 관리자 페이지
        
        eunseo
        
        meowmeowmeow1
        
    
    ![image.png](image1/image%206.png)
    
    ![image.png](image1/image%207.png)
    
    ![image.png](image1/image%208.png)
    

물리적 구조

- 공유기 관리자 페이지에서 유선 포트 정보, 무선 단말 정보를 확인할 수 있었다

![image.png](image1/image%209.png)

논리적 구조

![image.png](image1/image%2010.png)

- DHCP NIC1 : vmbr0, NIC2: vmbr1

![image.png](image1/image%2011.png)

### lo (loopback)

- 해당 머신이 자기 자신과 통신하는 가상 인터페이스
- 127.0.0.1/8, 패킷이 절대 밖으로 안 나감
    - ex. 웹서버 띄우고 `curl http://127.0.0.1:8080` 이런 거

loopback을 포트포워딩 한다

- 같은 호스트 안에서 “외부 포트 → 127.0.0.1:포트” 로 리다이렉트
    - ex. 개발 서버는 로컬이고, 프록시는 80번 포트로 받고 싶을 때 
    (nginx 리버스 프록시랑 비슷한 듯)
    - iptables: `0.0.0.0:80 → 127.0.0.1:3000` 리다이렉트
    - `http://서버:80` 으로 붙어도 dev 서버로 감

- **iptables 포트포워딩 (DNAT)**
    - 커널이 L3/L4에서
        
        `공인IP:80 → 127.0.0.1:3000` 이런 식으로 **목적지 주소만 바꾸는 것**
        
- **nginx 리버스 프록시**
    - nginx 프로세스가 클라 요청을 읽고, (L7)
        
        **새 TCP 연결**로 `127.0.0.1:3000` 또는 `spring:8080`에 접속해서 받은 뒤 되돌려줌
        
